<% content_for :title, "#{@location.name} Lawn Mower Repair Shops | GreenPal" %>

<section class="relative">
  <div class="h-64 bg-gradient-to-r from-gray-700 to-gray-900 relative overflow-hidden">
    <div class="absolute inset-0 opacity-50">
      <img src="https://images.unsplash.com/photo-1621905252507-b35492cc74b4?w=1400&h=400&fit=crop" alt="Lawn mower repair" class="w-full h-full object-cover">
    </div>
    <div class="absolute inset-0 bg-black/30"></div>
    <div class="relative h-full flex items-center justify-center">
      <div class="bg-white rounded-lg px-8 py-6 shadow-lg flex items-center gap-4">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-800">
          Find the best lawn mower repair<br>shops in <%= @location.full_name %>
        </h1>
        <div class="bg-green-500 text-white px-3 py-2 rounded-lg text-center">
          <span class="text-2xl font-bold"><%= @shops_count %></span>
          <span class="text-sm block">near you</span>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="bg-white border-b">
  <div class="max-w-7xl mx-auto px-6 py-4">
    <nav class="flex items-center gap-2 text-sm mb-4">
      <%= link_to "GreenPal", root_path, class: "text-sky-500 hover:underline" %>
      <span class="text-gray-400">›</span>
      <%= link_to "Lawn Mower Repair", "#", class: "text-sky-500 hover:underline" %>
      <span class="text-gray-400">›</span>
      <span class="text-gray-600"><%= @location.name %></span>
    </nav>
    
    <h2 class="text-2xl font-bold text-gray-800 mb-4">
      The best lawn mower repair shops in <%= @location.full_name %>
    </h2>
    
    <%= form_with url: location_shops_path(location_slug: @location.slug), method: :get, local: true, class: "flex flex-col md:flex-row gap-4" do |f| %>
      <div class="flex-1 relative">
        <svg class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
        </svg>
        <%= f.text_field :q, value: params[:q], placeholder: "Search by Shops",
            class: "w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none" %>
      </div>
      <div class="relative">
        <%= f.select :sort, [["Recommended", "recommended"], ["Distance", "distance"], ["Rating", "rating"], ["Price: Low to High", "price_low"]], 
            { selected: params[:sort] || "recommended" },
            class: "appearance-none px-6 py-3 pr-12 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-sky-500 focus:border-sky-500 outline-none cursor-pointer" %>
        <svg class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
        </svg>
      </div>
      <%= f.submit "Search", class: "px-6 py-3 bg-sky-500 text-white rounded-lg font-semibold hover:bg-sky-600 cursor-pointer" %>
    <% end %>
  </div>
</section>

<div class="max-w-7xl mx-auto px-6 py-6">
  <div class="flex flex-col lg:flex-row gap-6">
    <div class="flex-1 space-y-6">
      <% @shops.each do |shop| %>
        <%= render 'shared/shop_card', shop: shop %>
      <% end %>
      
      <% if @shops.empty? %>
        <div class="bg-white rounded-xl shadow-sm border p-8 text-center">
          <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <h3 class="text-lg font-semibold text-gray-700 mb-2">No shops found</h3>
          <p class="text-gray-500">Try adjusting your search or filters.</p>
        </div>
      <% end %>
      
      <div class="py-4">
        <%== pagy_nav(@pagy) if @pagy.pages > 1 %>
      </div>
    </div>

    <div class="lg:w-96">
      <div class="sticky top-6">
        <div id="map" 
             class="rounded-xl overflow-hidden h-96 bg-gray-200"
             data-controller="map"
             data-map-latitude-value="<%= @location.latitude %>"
             data-map-longitude-value="<%= @location.longitude %>"
             data-map-shops-value="<%= @shops.to_json(only: [:id, :name, :latitude, :longitude]) %>">
          <div class="w-full h-full flex items-center justify-center text-gray-500">
            <p>Loading map...</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
